# After changing this file, check it on:
#   http://lint.travis-ci.org/

dist: bionic

services:
  - mongodb # For fireworks

# Environment base builds
language: generic
os: linux

jobs:
  include:

    - env:
      - NAME="BASE 3.7"
      - PYTHON_VER=3.7
      - ENVIRON=BASE

    - env:
      - NAME="BASE 3.8"
      - PYTHON_VER=3.8
      - ENVIRON=BASE

    - env:
      - NAME="Adapters/Parsl 3.7"
      - PYTHON_VER=3.7
      - ENVIRON=ADAPTER_PARSL

    - env:
      - NAME="Adapters/Dask 3.7"
      - PYTHON_VER=3.7
      - ENVIRON=ADAPTER_DASK

    - env:
      - NAME="Adapters/Fireworks 3.7"
      - PYTHON_VER=3.7
      - ENVIRON=ADAPTER_FIREWORKS

    - env:
      - NAME="OpenFF 3.7"
      - PYTHON_VER=3.7
      - ENVIRON=OPENFF

    #- env: &dev_head
    #  - NAME="Development 3.8"
    #  - PYTHON_VER=3.8
    #  - ENVIRON=DEV_HEAD

  #allow_failures:
  #  - os: linux
  #    env: *dev_head

before_install:
  # Additional info about the build
  - uname -a
  - free -m
  - df -h
  - ulimit -a

  # Setup python environment
  - source devtools/travis-ci/before_install.sh
  - python -V

install:
    # Create test environment for package
  - echo $ENVIRON
  - python devtools/scripts/conda_env.py -n=test -p=$PYTHON_VER devtools/conda-envs/${ENVIRON,,}.yaml
  - source activate test

    # Build and install package
  - python setup.py develop --no-deps

before_script:
  - python -V
  - mongod --version
  - conda list
  - psql --version

script:
  - pytest -v -rsx --runslow --cov=qcfractal qcfractal/ --tb=short

notifications:
  email: false

after_success:
  - codecov

