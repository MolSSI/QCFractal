# After changing this file, check it on:
#   http://lint.travis-ci.org/

dist: bionic

services:
  - mongodb # For fireworks

# Environment base builds
language: generic
os: linux

# This specifies the python version in travis. However,
# we don't actually use this python (we use conda). This
# is a workaround for the fact we can't use multiple env
# blocks to build a job matrix
python:
  - 3.7
  - 3.8

env:
  - ENVIRON=BASE
  - ENVIRON=ADAPTER_PARSL
  - ENVIRON=ADAPTER_DASK
  - ENVIRON=ADAPTER_FIREWORKS
  - ENVIRON=OPENFF
  - ENVIRON=DEV_HEAD

jobs:
  allow_failures:
    - os: linux
      env: *dev_head

before_install:
  # Additional info about the build
  - uname -a
  - free -m
  - df -h
  - ulimit -a

  # Setup python environment
  - source devtools/travis-ci/before_install.sh
  - python -V

install:
  - PYTHON_VER=${TRAVIS_PYTHON_VERSION}
  - echo ${ENVIRON} ${PYTHON_VER}
  - python devtools/scripts/conda_env.py -n=test -p=$PYTHON_VER devtools/conda-envs/${ENVIRON,,}.yaml
  - source activate test

    # Build and install package
  - python setup.py develop --no-deps

before_script:
  - python -V
  - mongod --version
  - conda list
  - psql --version

script:
  - pytest -v -rsx --runslow --cov=qcfractal qcfractal/ --tb=short

notifications:
  email: false

after_success:
  - codecov

